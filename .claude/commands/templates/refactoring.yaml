name: "Code Refactoring"
description: "Template for structured code refactoring with safety and testing"
category: "refactoring"
complexity_level: "medium"
estimated_time: "6-10 hours"
variables:
  - name: target_module
    description: "Module or component to refactor (e.g., auth, database, ui/components)"
    type: string
    required: true
  - name: refactoring_goals
    description: "What to improve (e.g., readability, performance, testability)"
    type: array
    required: true
  - name: test_strategy
    description: "Testing approach (unit, integration, e2e)"
    type: string
    required: false
    default: "unit"
phases:
  - name: "Analysis and Planning"
    dependencies: []
    tasks:
      - "Analyze current {{target_module}} implementation"
      - "Identify code smells and improvement opportunities"
      - "Document current behavior and API contracts"
      - "Create refactoring goals: {{#each refactoring_goals}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}"
      - "Identify risk areas and breaking changes"
      - "Plan incremental refactoring steps"
      - "Set success criteria for refactoring"
  - name: "Pre-Refactoring Testing"
    dependencies: [1]
    tasks:
      - "Write comprehensive {{test_strategy}} tests for current behavior"
      - "Ensure all existing tests pass (baseline)"
      - "Add tests for edge cases not currently covered"
      - "Measure current test coverage (aim for >80%)"
      - "Document any untestable behavior"
      - "Create test suite that must pass post-refactoring"
  - name: "Incremental Refactoring"
    dependencies: [2]
    tasks:
      - "Refactor step 1: Extract complex functions into smaller units"
      - "Run tests after step 1 (must pass)"
      - "Refactor step 2: Improve naming and code organization"
      - "Run tests after step 2 (must pass)"
      - "Refactor step 3: Optimize performance bottlenecks (if goal)"
      - "Run tests after step 3 (must pass)"
      - "Refactor step 4: Improve error handling and edge cases"
      - "Run tests after step 4 (must pass)"
      - "Review refactored code for quality improvements"
  - name: "Validation and Documentation"
    dependencies: [3]
    tasks:
      - "Run full test suite (all tests must pass)"
      - "Verify no regression in functionality"
      - "Measure improvements (performance, coverage, complexity)"
      - "Update documentation to reflect changes"
      - "Update architecture diagrams if structure changed"
      - "Document any API changes or breaking changes"
      - "Add refactoring notes to changelog"
      - "Code review with team (if applicable)"
research_topics:
  - "Code refactoring best practices for {{target_module}}"
  - "{{#each refactoring_goals}}Improving {{this}} in codebases{{#unless @last}}; {{/unless}}{{/each}}"
  - "Safe refactoring techniques with {{test_strategy}} testing"
  - "Code quality metrics and measurement"
